name: expression_analysis_prompt
version: "9.0"
description: Content selector prompt for extracting expressions from TV show dialogues

prompt: |
  **You do NOT need to translate anything.**
  **Focus purely on CONTENT SELECTION - identifying the best expressions.**
  **Use INDICES to reference dialogues, not timestamps or text.**
  ---
  Here is a segment of dialogue from the TV show "{show_name}":

  **SOURCE DIALOGUES ({source_language}):**
  ---
  {source_dialogues}
  ---

  **TARGET DIALOGUES ({target_language}):**
  ---
  {target_dialogues}
  ---

  **INPUT FORMAT:**
  Each dialogue line is formatted as: `[index] dialogue_text`
  Use these indices in your output to reference specific dialogues.
  The system will look up actual text and timestamps from the indices you provide.

  ---

  **‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL LANGUAGE REQUIREMENTS - READ CAREFULLY ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è**

  **MUST BE IN {target_language}:**
  - `title` - Catchy title for learners
  - `title` - Catchy title for learners
  - `catchy_keywords` - Social media hook phrases
  - `narrations` - All narration text
  - `intro_hook` - Opening hook
  - `expression_translation` - Translation of the expression
  - All `translation` fields in annotations

  **MUST BE IN {source_language}:**
  - `viral_title` - Iconic quote from the scene
  - `expression` - The key phrase (copied exactly from source dialogue)
  - `similar_expressions` - Alternative expressions
  - `word` field in vocabulary_annotations
  - `expression` field in expression_annotations

  **‚ùå NEVER MIX LANGUAGES IN THE SAME FIELD**

  ---

  **YOUR MISSION:**
  Find {min_expressions}-{max_expressions} expressions from the {source_language} dialogues that learners would be EXCITED to learn.

  **LANGUAGE LEVEL:** {level_description}

  **PRIORITIZE HIGH-ENERGY MOMENTS:**
  - üòÇ HUMOROUS: Funny, witty, sarcastic moments
  - üî• DRAMATIC: High tension, conflict, confrontation
  - üòç ROMANTIC: Flirty, charming interactions
  - üò≤ SURPRISING: Unexpected twists or reveals

  ---

  **EXPRESSION CRITERIA:**

  **‚úÖ EXTRACT expressions that are:**
  - **COMMON & REUSABLE:** Native speakers use weekly in various situations
  - **SUBSTANTIAL:** 3+ words (phrasal verbs, idioms, colloquial phrases)
    - Good: "get on my nerves", "figure out what to do", "cut to the chase"
    - Bad: "bullshit", "damn it" (too simple)
  - **NON-OBVIOUS:** Has meaning/usage pattern that isn't self-explanatory
  - **HIGH-ENERGY SCENE:** Funny, dramatic, tense, romantic, or surprising moment

  **‚ùå NEVER EXTRACT:**
  - Plain statements: "I agree", "That's good"
  - Scene-specific phrases that only work in this exact context
  - Formal jargon or boring procedural dialogue
  - Simple 1-2 word phrases or basic curses

  ---

  **‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CONTEXT DESIGN - CRITICAL: INCLUDE THE FULL STORY ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è**

  **PROBLEM TO AVOID:** Do NOT cut the context short. Learners need the COMPLETE mini-story to understand and enjoy the clip.

  **GOAL:** Each clip = standalone mini-story that makes sense WITHOUT watching the full episode.

  **REQUIRED STRUCTURE:**
  1. **BEGINNING (Setup):** Establish WHO these people are and WHAT situation they're in
  2. **MIDDLE (Expression):** The expression appears naturally in context
  3. **END (Resolution):** Include the reaction/response that completes the moment

  **MANDATORY RULES:**
  - **Duration:** {target_duration} seconds (¬±15 seconds flexibility)
  - **Expression placement:** Must appear in the MIDDLE, NOT at the very start or end
  - **Complete sentences:** Start and end on complete sentences, no cut-offs
  - **Story completeness:** A first-time viewer must understand what's happening

  **QUALITY TEST - Ask yourself:**
  - ‚úì Can someone who's never seen this show understand the situation?
  - ‚úì Does the clip have a clear beginning, middle, and end?
  - ‚úì Is there enough setup BEFORE the expression?
  - ‚úì Is there a reaction/response AFTER the expression?
  - ‚úì Would this clip be entertaining on its own?

  **‚ùå BAD CONTEXT (too short, cuts off story):**
  - Starting right when expression appears (no setup)
  - Ending right after expression (no reaction)
  - Missing who the characters are or why they're talking

  **‚úÖ GOOD CONTEXT (complete story):**
  - Shows the situation/conflict that leads to the expression
  - Expression feels natural in the middle of the conversation
  - Includes the other person's reaction or the consequence

  ---

  **NO OVERLAPPING CLIPS:**

  When extracting multiple expressions:
  - Each clip's index range must NOT overlap with others
  - Clip 1 ends at index 8 ‚Üí Clip 2 must start at index 9 or later
  - Clips should flow chronologically (gaps OK, overlaps NOT OK)

  ---

  **VIRAL TITLE:**

  The iconic, meme-worthy quote from the scene.

  **Language:** {source_language} (original dialogue)
  **Length:** 3-12 words
  **Source:** Preferably a direct quote from the scene's peak moment

  Examples:
  - "ÎãàÍπåÏßì Í≤å ÎÇ† Ï£ΩÏó¨?"
  - "I don't have dreams, I have goals."
  - "Ïó∞ÏßÑÏïÑ, Ïù¥Í±∞ ÎàÑÍµ¨ Îî∏Ïù¥Îãà?"

  ---

  **CATCHY KEYWORDS:**

  Short, punchy social media hooks.

  **Language:** {target_language}
  **Format:** 3-6 words each, hashtag/TikTok caption style
  **Count:** 2-3 keywords per expression

  Good: "#AwkwardQuestion", "#DirectHitToBoss", "#GoosebumpTwist"
  Bad: "#Scene of interview", "#Two people talking"

  ---

  **NARRATIONS:**

  Timestamped commentary throughout the video in {target_language}.

  **Types:**
  - `hook` (start): "Hey, look at this!"
  - `highlight` (key moment): "This phrase is super common"
  - `reaction` (dramatic): "Look at that face lol"
  - `tension` (suspense): "What will they say?"
  - `commentary` (relatable): "100% relatable for office workers lol"

  **Rules:**
  - 3-6 narrations per clip, spaced throughout
  - Casual tone, internet slang OK (lol, omg, fr)
  - 5-15 words each
  - **‚ùå Do NOT just translate the dialogue or expression.** Narration must be COMMENTARY.
  - Don't narrate every line - let the scene breathe

  **Format:**
  ```json
  "narrations": [
    {{"dialogue_index": 2, "text": "narration in {target_language}", "type": "hook"}},
    {{"dialogue_index": 5, "text": "narration in {target_language}", "type": "highlight"}}
  ]
  ```

  ---

  **ANNOTATIONS:**

  **vocabulary_annotations** - Single difficult WORDS from {source_language}:
  ```json
  {{"word": "{source_language} word", "translation": "{target_language} translation", "dialogue_index": 5}}
  ```

  **expression_annotations** - Multi-word IDIOMS from {source_language}:
  ```json
  {{"expression": "{source_language} idiom", "translation": "{target_language} translation", "dialogue_index": 7}}
  ```

  **‚ö†Ô∏è ZERO OVERLAP between vocabulary and expression annotations** (displayed on same visual layer)
  - ‚ùå vocabulary: "rat" + expression: "rat me out" (OVERLAPS!)
  - ‚úÖ vocabulary: "leverage" + expression: "cut to the chase" (no overlap)

  ---

  **OUTPUT FORMAT (JSON only):**

  ```json
  {{
    "expressions": [
      {{
        "title": "Catchy title in {target_language} (8-15 words)",
        "viral_title": "Iconic line in {source_language} (3-12 words)",
        "expression": "key phrase copied exactly from {source_language} dialogue (4-8 words)",
        "expression_translation": "translation in {target_language}",
        "expression_dialogue_index": 5,
        "context_start_index": 2,
        "context_end_index": 12,
        "narrations": [
          {{"dialogue_index": 2, "text": "{target_language} narration", "type": "hook"}},
          {{"dialogue_index": 5, "text": "{target_language} narration", "type": "highlight"}},
          {{"dialogue_index": 8, "text": "{target_language} narration", "type": "reaction"}},
          {{"dialogue_index": 11, "text": "{target_language} narration", "type": "tension"}}
        ],
        "catchy_keywords": [
          "{target_language} keyword 1",
          "{target_language} keyword 2",
          "{target_language} keyword 3"
        ],
        "vocabulary_annotations": [
          {{"word": "{source_language} word", "translation": "{target_language}", "dialogue_index": 3}}
        ],
        "expression_annotations": [
          {{"expression": "{source_language} idiom", "translation": "{target_language}", "dialogue_index": 7}}
        ],
        "similar_expressions": ["{source_language} alt 1", "{source_language} alt 2"],
        "scene_type": "humor|drama|tension|emotional|confrontation|sexy|surprising",
        "intro_hook": "Short hook in {target_language}"
      }}
    ]
  }}
  ```

  ---

  **FINAL CHECKLIST:**

  **Content Quality:**
  - ‚úì Expression is 3+ words, common, reusable
  - ‚úì Scene is high-energy (funny/dramatic/tense/romantic)
  - ‚úì Expression copied exactly from source dialogue

  **Context Completeness:**
  - ‚úì Context is ~{target_duration} seconds (complete story)
  - ‚úì Has setup BEFORE expression (beginning)
  - ‚úì Expression appears in MIDDLE
  - ‚úì Has reaction AFTER expression (end)
  - ‚úì First-time viewer can understand what's happening

  **Language Compliance:**
  - ‚úì `title`, `catchy_keywords`, `narrations`, `intro_hook` ‚Üí {target_language}
  - ‚úì `viral_title`, `expression`, `similar_expressions` ‚Üí {source_language}
  - ‚úì All `translation` fields ‚Üí {target_language}
  - ‚úì Annotation `word`/`expression` fields ‚Üí {source_language}

  **Technical:**
  - ‚úì No overlapping clip index ranges
  - ‚úì No overlap between vocabulary and expression annotations
  - ‚úì Valid JSON format

  ---

  **CRITICAL: Respond with ONLY valid JSON. No markdown, no explanations.**

  If you find expressions: Return the JSON object
  If NO good expressions found: {{"expressions":[]}}