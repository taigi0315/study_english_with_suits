# LangFlix Default Configuration
# This file contains all default settings for the LangFlix application
# To customize these settings, copy this file to config.yaml at the project root

# ============================================================================
# Application Settings
# ============================================================================
app:
  # Name of the TV show for prompting
  show_name: "Shows"
  
  # Template file for expression analysis prompt
  # V1: expression_analysis_prompt_v7.txt (includes translation)
  # V2: expression_analysis_prompt_v8.txt (dual-language input format)
  template_file: "expression_analysis_prompt_v8.txt"

# ============================================================================
# V2: Dual Language Subtitle Configuration
# ============================================================================
dual_language:
  # Enable V2 dual-language mode (uses Netflix subtitles for both languages)
  enabled: true  # V2 mode: Load both source and target subtitles, use fuzzy matching
  
  # Default source language (language being learned)
  default_source_language: "Korean"
  
  # Default target language (user's native language)
  default_target_language: "Spanish"
  
  # Subtitle file naming pattern
  # Netflix format: {index}_{Language}.srt (e.g., "3_Korean.srt", "6_English.srt")
  subtitle_pattern: "{index}_{Language}.srt"
  
  # Variant selection when multiple subtitle files exist for same language
  # Options: "first" (use first file), "last" (use last file), "largest" (use largest file)
  variant_selection: "first"
  
  # V2 prompt template (used when dual_language.enabled is true)
  v2_template_file: "content_selection_prompt_v1.txt"

# ============================================================================
# Database Configuration
# ============================================================================
database:
  # Enable database integration (CLI defaults to false, API requires true)
  enabled: false
  
  # Database connection URL
  url: "postgresql://user:password@localhost:5432/langflix"
  
  # Connection pool settings
  pool_size: 5
  max_overflow: 10
  
  # SQL logging (set to true for debugging)
  echo: false

# ============================================================================
# LLM (Language Learning Model) Settings
# ============================================================================
llm:
  # Maximum characters of subtitle content per chunk
  # Increased from 800 to 3000 for cost optimization (fewer API calls)
  # Trade-off: Larger chunks = fewer calls but longer processing time
  max_input_length: 2000
  
  model_name: "gemini-2.5-flash"
  
  # Default language proficiency level for expression extraction
  # Options: beginner, intermediate, advanced, mixed
  default_language_level: "intermediate"
  
  # Target language for translations
  target_language: "Korean"
  
  # API retry configuration
  max_retries: 3
  retry_backoff_seconds: [3, 6, 12]  # Wait times between retries
  
  # Generation configuration
  temperature: 0.1
  top_p: 0.8
  top_k: 40
  
  # Expression ranking configuration (Phase 2)
  # NOTE: These settings are NOT currently used in the codebase
  # Keeping them commented for future reference
  # ranking:
  #   difficulty_weight: 0.4           # Weight for difficulty level (0-1)
  #   frequency_weight: 0.3             # Weight for expression frequency (0-1)
  #   educational_value_weight: 0.3     # Weight for educational value (0-1)
  #   fuzzy_match_threshold: 85         # Similarity threshold for duplicate detection (0-100)

# ============================================================================
# Processing Configuration
# ============================================================================
processing:
  # Test mode configuration for development
  # When enabled, limits processing to speed up testing
  test_mode:
    enabled: true                     # Set to true for development, false for production
    max_chunks: 1                     # Only process 1 chunk of subtitles
    max_expressions_per_chunk: 1      # Only extract 1 expression per chunk
    max_total_expressions: 1          # Total expressions limit for entire video
  
  # Normal mode expression limits (when test_mode.enabled is false)
  min_expressions_per_chunk: 3
  max_expressions_per_chunk: 6        # Up to 6 expressions per chunk in production

# ============================================================================
# Language Proficiency Levels
# ============================================================================
language_levels:
  beginner:
    description: "A1-A2 level. Focus on basic everyday expressions, simple phrasal verbs, and common conversational phrases used in daily life. Avoid complex idioms or advanced vocabulary."
    examples: "Let's go, I'm sorry, How are you, Can you help me, What's up"
  
  intermediate:
    description: "B1-B2 level. Focus on commonly used idiomatic expressions, standard phrasal verbs, and colloquial phrases that appear frequently in casual and professional contexts."
    examples: "Get the ball rolling, Call it a day, Piece of cake, Break the ice, On the same page"
  
  advanced:
    description: "C1-C2 level. Focus on sophisticated idioms, nuanced expressions, professional jargon, and complex colloquialisms that native speakers use in various contexts."
    examples: "Read between the lines, Cut to the chase, Play devil's advocate, Bite off more than you can chew"
  
  mixed:
    description: "All levels. Extract valuable expressions regardless of difficulty level, but prioritize practical, commonly-used phrases that appear in authentic conversations."
    examples: "Any useful expression from basic to advanced"

# ============================================================================
# Video Processing Settings
# ============================================================================
video:
  # Encoding preset (ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow)
  # Changed to "medium" for significantly better quality (TICKET-072)
  # Medium preset provides better compression and quality while maintaining reasonable encoding speed
  # ~2x slower than "fast" but much better quality, especially for 720p sources
  # Changed from "medium" to "slow" to prioritize QUALITY over speed (User Request)
  # Slow preset provides better compression and quality retention
  preset: "slow"

  # Constant Rate Factor - quality (0-51, lower = better quality, 18-28 is good range)
  # Changed to 18 for high quality output (TICKET-072)
  # CRF 18 provides near-lossless quality, especially important for 720p source videos
  # Lower values = better quality: 18-20 is excellent, 21-23 is good, 24+ is acceptable
  crf: 18

# ============================================================================
# Dialogue Subtitle Styling (Short-Form Video)
# ============================================================================
dialogue_subtitle:
  # Font size for dialogue subtitles (in short-form videos)
  font_size: 36              # Increased from 28 for better readability
  # Characters per line before wrapping
  chars_per_line: 60         # Slightly reduced due to larger font
  # Vertical margin from bottom (in pixels) - higher = further from bottom
  margin_v: 50               # Increased from 15 to move dialogue text higher
  # Source language color (the language being learned)
  source_color: "#FFFFFF"    # White
  # Target language color (translation)
  target_color: "#FFFF00"    # Yellow
  # Order: source language first, then translation
  source_first: true

# ============================================================================
# Font Configuration
# ============================================================================
font:
  sizes:
    default: 28                  # Default font size (reduced from 36)
    expression_dialogue: 32      # Full dialogue line containing expression (reduced from 42)
    expression: 36               # Main expression/phrase (emphasized, larger) (reduced from 48)
    expression_dialogue_trans: 36  # Translation of dialogue line (reduced from 42)
    expression_trans: 36         # Translation of expression (emphasized) (reduced from 48)
    similar: 36                  # Similar expressions text (reduced from 42)

  # Per-Language Font Configuration
  # Maps language codes to specific fonts for different use cases
  # Paths are relative to the project root (or absolute)
  language_fonts:
    # Fallback defaults if language is not specified
    default:
      default: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      dialogue: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      keywords: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      expression: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      translation: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      vocabulary: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      educational_slide: "assets/fonts/Maplestory Bold/Maplestory Bold.ttf"
      title: "assets/fonts/Maplestory Bold/Maplestory Bold.ttf"

    # Korean (Source/Target)
    ko:
      default: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      dialogue: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      keywords: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      expression: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      translation: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      vocabulary: "assets/fonts/1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      educational_slide: "assets/fonts/Maplestory Bold/Maplestory Bold.ttf"

    # Spanish
    es:
      default: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      dialogue: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      keywords: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      expression: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      translation: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      vocabulary: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"
      educational_slide: "assets/fonts/es/F37 Moon VF/F37Moon-VF.ttf"

# NOTE: Processing section already defined above (lines 69-80)
# Duplicate section removed in V2 cleanup

# ============================================================================
# Video Transition Settings
# ============================================================================
transitions:
  # Enable smooth transitions between video segments
  enabled: true

  # Context to expression transition (dedicated transition video segment)
  context_to_expression_transition:
    enabled: true
    duration: 1.2 
    image_path_9_16: "assets/transition_9_16.png"  # For short-form (9:16 aspect ratio)
    image_path_16_9: "assets/transition_16_9.png"  # For long-form (16:9 aspect ratio)
    sound_effect_path: "assets/sound_effect.mp3"
    sound_effect_volume: 0.5  # Volume level (0.0-1.0)

  # Transition from video segment to educational slide (long-form and short-form sequential layout)
  context_to_slide_transition:
    enabled: true
    duration: 1.0  # 1 second transition
    image_path_16_9: "assets/transition_16_9.png"  # For long-form (16:9 aspect ratio)
    image_path_9_16: "assets/transition_9_16.png"  # For short-form (9:16 aspect ratio)
    sound_effect_path: "assets/sound_effect.mp3"
    sound_effect_volume: 0.5  # Volume level (0.0-1.0)

  # Ending credit (appended at the very end of the video)
  ending_credit:
    enabled: true
    duration: 3.0  # How long to show the ending credit (seconds)
    video_path: "assets/ending_credit_mp4.mp4"  # MP4 or GIF file

# ============================================================================
# Text-to-Speech (TTS) Settings
# ============================================================================
tts:
  # Enable TTS for expression audio
  enabled: true
  
  # TTS provider (lemonfox, google, aws, etc.)
  provider: "google"

  # Gemini TTS Configuration (Google GenAI library)
  google:
    # api_key: "set via GEMINI_API_KEY environment variable"
    language_code: "en-us"  # Original language (English) for audio generation
    model_name: "gemini-2.5-flash"  # Gemini TTS model for high-quality synthesis
    response_format: "wav"  # Audio format (WAV for new API)
    # SSML speaking rate options: x-slow, slow, medium, fast, x-fast, or percentage like "0.8"
    speaking_rate: "high" 
    # SSML pitch options: x-low, low, medium, high, x-high, percentage like "+10%" or semitones like "-2st"
    pitch: "-2st"  # SSML pitch: one semitone lower for more natural sound
    # Voice selection for TTS generation (uses Gemini voices from https://ai.google.dev/gemini-api/docs/speech-generation#voices)
    alternate_voices: ["Despina", "Puck"]  # Available Gemini voices
  
  # LemonFox TTS Configuration (fallback)
  lemonfox:
    # api_key: "set via LEMONFOX_API_KEY environment variable"
    voice: "sarah"
    response_format: "mp3"  # mp3 format as requested
  # 
  # aws:
  #   region: "us-east-1"
  #   voice_id: "Joanna"
  #   engine: "neural"

# ============================================================================
# Short Video Settings
# ============================================================================
short_video:
  # Enable short video generation
  enabled: true

  # Video resolution (width x height) - 9:16 format for social media
  resolution: "1080x1920"

  # Target duration for each batch (seconds)
  target_duration: 120

  # Allow variance (+/- seconds)
  duration_variance: 10

  # Maximum duration for short-form video batches (seconds)
  # Videos exceeding this duration will be dropped from batching
  max_duration: 180

  # Layout configuration for short-form videos (9:16 portrait format)
  layout:
    # Video dimensions
    target_width: 1080
    target_height: 1920

    # Structured video height in middle section
    long_form_video_height: 1040  # Expanded from 960 (1920 - 440*2 = 1040)

    # Padding areas (reduced from 480 to 440)
    top_padding_height: 440      # Top black padding (0-440px)
    bottom_padding_height: 440   # Bottom black padding (1480-1920px)

    # Catchy keywords (top padding area)
    keywords:
      font_size: 35
      newline: 175
      y_position: 210            # Adjusted for smaller padding (was 250)
      line_height_factor: 1.2    # Line spacing as multiple of font size
      max_width_percent: 0.9     # Maximum width as percentage of video width
      text_color: 'white'
      border_width: 2
      border_color: 'black'

    # Expression text (bottom padding area)
    expression:
      font_size: 50              # Main expression font size (increased by 10 from 45)
      y_position: 1530           # Adjusted for new layout (video ends at 1480)
      chars_per_line: 40         # Characters per line before wrapping (increased from 28)
      text_color: 'yellow'
      border_width: 2
      border_color: 'black'

    # Expression translation (bottom padding area)
    translation:
      font_size: 50
      y_position: 1680           # Adjusted for new layout
      gap_from_expression: 60    # Gap between expression and translation
      chars_per_line: 40         # Max characters per line before wrapping
      text_color: 'yellow'
      border_width: 2
      border_color: 'black'
      background_opacity: 0.5    # 50% opacity for background

    # Dialogue subtitles (bottom padding area, below expression)
    dialogue_subtitle:
      font_size: 24
      newline: 60
      margin_v: 90
      text_color: 'white'
      outline_width: 1
      outline_color: 'black'
      background_opacity: 0.75

    # Font configuration for short-form video text overlays
    # Font paths are relative to the 'assets/fonts' directory
    fonts:
      # Catchy keywords (hashtags at top)
      keywords: "1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      
      # Expression text (bottom - main English/Korean expression)
      expression: "1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      
      # Expression translation (bottom - translated expression)
      translation: "1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      
      # Title (catchy title overlay - future use)
      title: "Maplestory Bold/Maplestory Bold.ttf"
      
      # Vocabulary annotations (dynamic word overlays)
      vocabulary: "1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"

    # Vocabulary annotations (dynamic overlays that appear when words are spoken)
    vocabulary_annotations:
      font_size: 45                # Font size for vocabulary text
      text_color: 'yellow'         # Text color
      border_width: 2              # Border width
      border_color: 'black'        # Border color
      x_position: 25               # X position (px from left)
      y_offset: 25                 # Y offset from top of video area
      duration: 4.0                # How long annotation appears (seconds)

    # Viral title (top of video, attention-grabbing hook in source language)
    title:
      font_size: 75                # Large font for emphasis
      y_position: 25               # Below logo, above keywords
      chars_per_line: 25           # Max characters per line before wrapping
      text_color: '#FF4444'        # Red for attention
      border_width: 3              # Thick border for visibility
      border_color: 'black'
      display_duration: 0.0        # 0 = entire video, >0 = fade out after N seconds

    # Narrations (commentary overlays in target language)
    narrations:
      font_size: 55                # Medium size
      y_position: 320              # Upper-middle area (below video top padding)
      chars_per_line: 32           # Max characters per line before wrapping
      text_color: '#00FF00'        # Green for visibility
      background_color: '#000000'  # Black background
      background_opacity: 0.7      # Semi-transparent
      border_width: 2
      border_color: 'black'
      duration: 3.0                # How long each narration shows
      # Per-type color overrides (optional)
      type_colors:
        hook: '#FF6B6B'            # Red for hooks
        highlight: '#00BFFF'       # Blue for educational highlights
        reaction: '#FFD700'        # Gold for reactions
        tension: '#FF69B4'         # Pink for tension
        commentary: '#00FF00'      # Green default

    # Expression annotations (idiom/phrase overlays)
    expression_annotations:
      font_size: 45                # Smaller than vocab
      x_position: 40               # Left side
      y_offset: 520                # Below narrations area
      text_color: '#0088FF'        # Blue to distinguish from vocab (yellow)
      border_width: 2
      border_color: 'black'
      duration: 3.0                # How long annotation appears

    # Educational slide configuration (displayed during expression replay)
    educational_slide:
      # Font for educational slide (relative to assets/fonts)
      font: "1HoonGrimdonghwa Regular/1HoonGrimdonghwa Regular.ttf"
      
      # Show/hide elements (set to false to disable)
      show_expression_highlight: false      # Yellow expression line (disabled - duplicate)
      show_translation_highlight: false     # Yellow translation line (disabled - duplicate)
      
      # Font sizes for slide elements
      font_sizes:
        expression_dialogue: 36
        expression: 36
        expression_dialogue_trans: 36
        expression_translation: 36
        similar: 32

      # Positioning (Y offsets from center)
      positions:
        expression_dialogue_y: -180  # Distance above center (moved down)
        expression_y: -150           # Expression (highlighted)
        expression_dialogue_trans_y: 40  # At center (moved down slightly)
        expression_translation_y: 70  # Below center
        similar_base_offset: 180     # Distance from bottom (lower = moved down from 250)
        similar_line_spacing: 42     # Space between similar expressions
      
      # Line breaking for long text (max words before adding newline)
      line_breaking:
        expression_dialogue_max_words: 5
        expression_translation_max_words: 6

# ============================================================================
# Expression-Based Learning Configuration
# ============================================================================
expression:
  # Global expression repeat count for TTS, original audio, and short videos
  # This unified setting controls how many times expressions are repeated
  # for educational purposes across all video types (educational videos, short videos)
  repeat_count: 2
  
  # LLM processing configuration
  llm:
    # Parallel processing configuration for expression analysis
    parallel_processing:
      enabled: false  # Enable parallel processing for multiple chunks
      max_workers: null  # null = auto-detect (min(cpu_count(), 5))
      timeout_per_chunk: 300  # seconds (5 minutes per chunk)
      batch_size: null  # null = process all chunks at once

    # Multiple expressions per context configuration
    allow_multiple_expressions: true  # Enable/disable multiple expressions per context feature
  
  # Educational video generation mode
  # Options: "separate" (one video per expression) or "combined" (one video per group - Phase 2)
  educational_video_mode: "separate"  # Default: separate mode (backward compatible)
  
  # Subtitle styling configuration
  subtitle_styling:
    default:
      color: '#FFFFFF'
      font_family: 'Arial'
      font_size: 16
      font_weight: 'normal'
      background_color: '#000000'
      background_opacity: 0.5
      position: 'bottom'
      margin_bottom: 40
    expression_highlight:
      color: '#FFD700'
      font_weight: 'bold'
      font_size: 28
      background_color: '#1A1A1A'
      background_opacity: 0.85
      animation: 'fade_in'
      duration_ms: 300
  
  # ASR configuration (removed - using external transcription)
  
  # Media processing configuration (Phase 4)
  media:
    # Video slicing settings
    slicing:
      quality: high  # low, medium, high, lossless
      buffer_start: 0.2  # seconds before expression
      buffer_end: 0.2    # seconds after expression
      output_format: mp4
      crf: 0           # Constant Rate Factor for quality
      preset: slow      # FFmpeg preset
      audio_bitrate: 256k
  
