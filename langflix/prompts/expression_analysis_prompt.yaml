name: expression_analysis_prompt
version: "10.0"
description: Content selector prompt for extracting expressions from TV show dialogues

prompt: |
  **You do NOT need to translate anything.**
  **Focus purely on CONTENT SELECTION - identifying the best expressions.**
  **Use INDICES to reference dialogues, not timestamps or text.**
  ---
  Here is a segment of dialogue from the TV show "{show_name}":

  **SOURCE DIALOGUES ({source_language}):**
  ---
  {source_dialogues}
  ---

  **TARGET DIALOGUES ({target_language}):**
  ---
  {target_dialogues}
  ---

  **INPUT FORMAT:**
  Each dialogue line is formatted as: `[index] dialogue_text`
  Use these indices in your output to reference specific dialogues.
  The system will look up actual text and timestamps from the indices you provide.

  ---

  **âš ï¸âš ï¸âš ï¸ CRITICAL LANGUAGE REQUIREMENTS - READ CAREFULLY âš ï¸âš ï¸âš ï¸**

  **MUST BE IN {target_language}:**
  - `title` - Catchy title for learners
  - `catchy_keywords` - Social media hook phrases
  - `narrations` - All narration text
  - `intro_hook` - Opening hook
  - `expression_translation` - Translation of the expression
  - All `translation` fields in annotations
  - `dialogues.{target_language_code}` - Target language dialogues array

  **MUST BE IN {source_language}:**
  - `viral_title` - Iconic quote from the scene
  - `expression` - The key phrase (copied exactly from source dialogue)
  - `similar_expressions` - Alternative expressions
  - `word` field in vocabulary_annotations
  - `expression` field in expression_annotations
  - `dialogues.{source_language_code}` - Source language dialogues array

  **âŒ NEVER MIX LANGUAGES IN THE SAME FIELD**

  ---

  **YOUR MISSION:**
  Find {min_expressions}-{max_expressions} expressions from the {source_language} dialogues that learners would be EXCITED to learn.

  **LANGUAGE LEVEL:** {level_description}

  **PRIORITIZE HIGH-ENERGY MOMENTS:**
  - ðŸ˜‚ HUMOROUS: Funny, witty, sarcastic moments
  - ðŸ”¥ DRAMATIC: High tension, conflict, confrontation
  - ðŸ˜ ROMANTIC: Flirty, charming interactions
  - ðŸ˜² SURPRISING: Unexpected twists or reveals

  ---

  **EXPRESSION CRITERIA:**

  **âœ… EXTRACT expressions that are:**
  - **COMMON & REUSABLE:** Native speakers use weekly in various situations
  - **SUBSTANTIAL:** 3+ words (phrasal verbs, idioms, colloquial phrases)
    - Good: "get on my nerves", "figure out what to do", "cut to the chase"
    - Bad: "bullshit", "damn it" (too simple)
  - **NON-OBVIOUS:** Has meaning/usage pattern that isn't self-explanatory
  - **HIGH-ENERGY SCENE:** Funny, dramatic, tense, romantic, or surprising moment

  **âŒ NEVER EXTRACT:**
  - Plain statements: "I agree", "That's good"
  - Scene-specific phrases that only work in this exact context
  - Formal jargon or boring procedural dialogue
  - Simple 1-2 word phrases or basic curses

  ---

  **âš ï¸âš ï¸âš ï¸ CONTEXT DESIGN - CRITICAL: INCLUDE THE FULL STORY âš ï¸âš ï¸âš ï¸**

  **PROBLEM TO AVOID:** Do NOT cut the context short. Learners need the COMPLETE mini-story to understand and enjoy the clip.

  **GOAL:** Each clip = standalone mini-story that makes sense WITHOUT watching the full episode.

  **REQUIRED STRUCTURE:**
  1. **BEGINNING (Setup):** Establish WHO these people are and WHAT situation they're in
  2. **MIDDLE (Expression):** The expression appears naturally in context
  3. **END (Resolution):** Include the reaction/response that completes the moment

  **MANDATORY RULES:**
  - **Duration:** {target_duration} seconds (Â±15 seconds flexibility)
  - **Expression placement:** Must appear in the MIDDLE, NOT at the very start or end
  - **Complete sentences:** Start and end on complete sentences, no cut-offs
  - **Story completeness:** A first-time viewer must understand what's happening

  **QUALITY TEST - Ask yourself:**
  - âœ“ Can someone who's never seen this show understand the situation?
  - âœ“ Does the clip have a clear beginning, middle, and end?
  - âœ“ Is there enough setup BEFORE the expression?
  - âœ“ Is there a reaction/response AFTER the expression?
  - âœ“ Would this clip be entertaining on its own?

  **âŒ BAD CONTEXT (too short, cuts off story):**
  - Starting right when expression appears (no setup)
  - Ending right after expression (no reaction)
  - Missing who the characters are or why they're talking

  **âœ… GOOD CONTEXT (complete story):**
  - Shows the situation/conflict that leads to the expression
  - Expression feels natural in the middle of the conversation
  - Includes the other person's reaction or the consequence

  ---

  **NO OVERLAPPING CLIPS:**

  When extracting multiple expressions:
  - Each clip's index range must NOT overlap with others
  - Clip 1 ends at index 8 â†’ Clip 2 must start at index 9 or later
  - Clips should flow chronologically (gaps OK, overlaps NOT OK)

  ---

  **VIRAL TITLE:**

  The iconic, meme-worthy quote from the scene.

  **Language:** {source_language} (original dialogue)
  **Length:** 3-12 words
  **Source:** Preferably a direct quote from the scene's peak moment

  Examples:
  - "I don't have dreams, I have goals."
  - "Winter is coming."
  - "I am the one who knocks."

  ---

  **CATCHY KEYWORDS:**

  Short, punchy social media hooks.

  **Language:** {target_language}
  **Format:** 3-6 words each, hashtag/TikTok caption style
  **Count:** 2-3 keywords per expression

  Good: "#AwkwardQuestion", "#DirectHitToBoss", "#GoosebumpTwist"
  Bad: "#Scene of interview", "#Two people talking"

  ---

  **NARRATIONS:**

  Timestamped commentary throughout the video in {target_language}.

  **Types:**
  - `hook` (start): "Hey, look at this!"
  - `highlight` (key moment): "This phrase is super common"
  - `reaction` (dramatic): "Look at that face lol"
  - `tension` (suspense): "What will they say?"
  - `commentary` (relatable): "100% relatable for office workers lol"

  **Rules:**
  - 5-9 narrations per clip, spaced throughout
  - Make narrations more friendly, conversational tone and HUMOROUS e.g) "ì™€- ì´ê±¸ í”¼í•´ê°€ë„¤", "Damn- that's was sick"
  - Always include narration at first dialogue index, and make this narration more engaging, giving hint of the upcoming story. 
  - Casual tone, internet slang OK (lol, omg, fr)
  - 5-15 words each
  - **âŒ Do NOT just translate the dialogue or expression.** Narration must be COMMENTARY.
  - Don't narrate every line - let the scene breathe

  **Format:**
  ```json
  "narrations": [
    {{"dialogue_index": 2, "text": "narration in {target_language}", "type": "hook"}},
    {{"dialogue_index": 5, "text": "narration in {target_language}", "type": "highlight"}}
  ]
  ```

  ---

  **ANNOTATIONS:**

  **vocabulary_annotations** - Single difficult WORDS from {source_language}:
  ```json
  {{"word": "{source_language} word", "translation": "{target_language} translation", "dialogue_index": 5}}
  ```

  **expression_annotations** - Multi-word IDIOMS from {source_language}:
  ```json
  {{"expression": "{source_language} idiom", "translation": "{target_language} translation", "dialogue_index": 7}}
  ```

  **âš ï¸ ZERO OVERLAP between vocabulary and expression annotations** (displayed on same visual layer)
  - âŒ vocabulary: "rat" + expression: "rat me out" (OVERLAPS!)
  - âœ… vocabulary: "leverage" + expression: "cut to the chase" (no overlap)

  ---

  **DIALOGUES FIELD - BILINGUAL SUBTITLE EXTRACTION:**

  For each expression, include the complete subtitle data for the context range with BOTH languages paired together.
  **NEW FORMAT:** Each dialogue entry contains ALL language translations paired together to prevent misalignment.

  **Format:**
  ```json
  "dialogues": [
    {{
      "index": 3,
      "timestamp": "00:00:49,460 --> 00:00:50,527",
      "{source_language_code}": "Gerald Tate's here.",
      "{target_language_code}": "ì œëŸ´ë“œ í…Œì´íŠ¸ê°€ ì™”ì–´ìš”."
    }},
    {{
      "index": 4,
      "timestamp": "00:00:50,595 --> 00:00:51,929",
      "{source_language_code}": "He wants to know what's happening to his deal.",
      "{target_language_code}": "ìžê¸° ê±°ëž˜ê°€ ì–´ë–»ê²Œ ëëŠ”ì§€ ì•Œê³  ì‹¶ëŒ€ìš”."
    }}
  ]
  ```

  **Rules:**
  - Extract dialogue entries from `context_start_index` to `context_end_index` (inclusive)
  - **index**: MUST match the original subtitle index exactly
  - **timestamp**: MUST be copied exactly from source
  - **{source_language_code}**: Source language text (e.g., "en": "English text")
  - **{target_language_code}**: Target language text (e.g., "ko": "í•œêµ­ì–´ í…ìŠ¤íŠ¸")
  - Each entry pairs the translations together to prevent hallucination
  - Use ISO 639-1 language codes (e.g., "en", "ko", "es", "ja", "zh")

  ---

  **OUTPUT FORMAT (JSON only):**

  ```json
  {{
    "expressions": [
      {{
        "title": "Catchy title in {target_language} (8-15 words)",
        "viral_title": "Iconic line in {source_language} (3-12 words)",
        "expression": "key phrase copied exactly from {source_language} dialogue (4-8 words)",
        "expression_translation": "translation in {target_language}",
        "expression_dialogue_index": 5,
        "context_start_index": 2,
        "context_end_index": 12,
        "dialogues": [
          {{
            "index": 2,
            "timestamp": "00:00:20,765 --> 00:00:23,933",
            "{source_language_code}": "{source_language} text",
            "{target_language_code}": "{target_language} text"
          }},
          {{
            "index": 3,
            "timestamp": "00:00:49,460 --> 00:00:50,527",
            "{source_language_code}": "{source_language} text",
            "{target_language_code}": "{target_language} text"
          }},
          {{
            "index": 4,
            "timestamp": "00:00:50,595 --> 00:00:51,929",
            "{source_language_code}": "{source_language} text",
            "{target_language_code}": "{target_language} text"
          }}
        ],
        "narrations": [
          {{"dialogue_index": 2, "text": "{target_language} narration", "type": "hook"}},
          {{"dialogue_index": 5, "text": "{target_language} narration", "type": "highlight"}},
          {{"dialogue_index": 8, "text": "{target_language} narration", "type": "reaction"}},
          {{"dialogue_index": 11, "text": "{target_language} narration", "type": "tension"}}
        ],
        "catchy_keywords": [
          "{target_language} keyword 1",
          "{target_language} keyword 2",
          "{target_language} keyword 3"
        ],
        "vocabulary_annotations": [
          {{"word": "{source_language} word", "translation": "{target_language}", "dialogue_index": 3}}
        ],
        "expression_annotations": [
          {{"expression": "{source_language} idiom", "translation": "{target_language}", "dialogue_index": 7}}
        ],
        "similar_expressions": ["{source_language} alt 1", "{source_language} alt 2"],
        "scene_type": "humor|drama|tension|emotional|confrontation|sexy|surprising",
        "intro_hook": "Short hook in {target_language}"
      }}
    ]
  }}
  ```
  
  ---
  
  **FINAL CHECKLIST:**
  
  **Content Quality:**
  - âœ“ Expression is 3+ words, common, reusable
  - âœ“ Scene is high-energy (funny/dramatic/tense/romantic)
  - âœ“ Expression copied exactly from source dialogue
  
  **Context Completeness:**
  - âœ“ Context is ~{target_duration} seconds (complete story)
  - âœ“ Has setup BEFORE expression (beginning)
  - âœ“ Expression appears in MIDDLE
  - âœ“ Has reaction AFTER expression (end)
  - âœ“ First-time viewer can understand what's happening
  
  **Dialogues Field:**
  - âœ“ Array of paired dialogue entries (not language-separated)
  - âœ“ Each entry has: index, timestamp, {source_language_code}, {target_language_code}
  - âœ“ Each entry contains BOTH language translations paired together
  - âœ“ index and timestamp are the same across all entries
  - âœ“ Covers all entries from context_start_index to context_end_index

  **Language Compliance:**
  - âœ“ `title`, `catchy_keywords`, `narrations`, `intro_hook` â†’ {target_language}
  - âœ“ `viral_title`, `expression`, `similar_expressions` â†’ {source_language}
  - âœ“ All `translation` fields â†’ {target_language}
  - âœ“ Annotation `word`/`expression` fields â†’ {source_language}
  - âœ“ `dialogues[].{source_language_code}` â†’ {source_language}
  - âœ“ `dialogues[].{target_language_code}` â†’ {target_language}

  **Technical:**
  - âœ“ expression_dialogue_index is BETWEEN context_start_index and context_end_index (CRITICAL!)
  - âœ“ All narration/annotation dialogue_index values are within [context_start_index, context_end_index]
  - âœ“ No overlapping clip index ranges
  - âœ“ No overlap between vocabulary and expression annotations
  - âœ“ Valid JSON format

  ---

  **CRITICAL: Respond with ONLY valid JSON. No markdown, no explanations.**

  If you find expressions: Return the JSON object
  If NO good expressions found: {{"expressions":[]}}